<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trade IPCA+</title>
    <link rel="stylesheet" href="style.css">
    <!-- Incluir Chart.js via CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1/plugin/customParseFormat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1/plugin/dayOfYear.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1/plugin/isLeapYear.js"></script>
    <script>dayjs.extend(window.dayjs_plugin_customParseFormat); dayjs.extend(window.dayjs_plugin_dayOfYear); dayjs.extend(window.dayjs_plugin_isLeapYear);</script>
</head>
<body>
    <header>
        <h1>Trade IPCA+</h1>
        <p>Compare investimentos IPCA+ com prazos diferentes e simule a rolagem.</p>
    </header>

    <main>
        <section id="input-section">
            <h2>Configuração dos Títulos</h2>
            <div class="options-container">
                <div class="option-card" id="short-option-card">
                    <h3>Opção Curta</h3>
                    <label for="short-indexer">Indexador:</label>
                    <input type="text" id="short-indexer" value="IPCA+" disabled>
                    <label for="short-rate">Taxa (% a.a.):</label>
                    <input type="number" id="short-rate" step="0.01" placeholder="Ex: 6.50">
                    <label for="short-term">Prazo (anos):</label>
                    <input type="number" id="short-term" step="0.1" placeholder="Ex: 2">
                </div>
                <div class="option-card" id="long-option-card">
                    <h3>Opção Longa</h3>
                    <label for="long-indexer">Indexador:</label>
                    <input type="text" id="long-indexer" value="IPCA+" disabled>
                    <label for="long-rate">Taxa (% a.a.):</label>
                    <input type="number" id="long-rate" step="0.01" placeholder="Ex: 7.00">
                    <label for="long-term">Prazo (anos):</label>
                    <input type="number" id="long-term" step="0.1" placeholder="Ex: 9">
                </div>
            </div>
            <button id="update-assumptions-btn">Atualizar Premissas</button>
        </section>

        <section id="assumptions-section" style="display: none;">
            <h2>Premissas Futuras (% a.a.)</h2>
            <p>Defina as projeções anuais para IPCA (0-15%, passo 0.5) e CDI (0-20%, passo 0.25). Os cálculos consideram o período pro-rata para o primeiro ano e perpetuidade após o 4º ano (usando os valores do último slider).</p>
            <div id="sliders-container">
                <!-- Sliders serão gerados dinamicamente aqui pelo JS -->
            </div>
             <button id="calculate-btn">Calcular Rentabilidade</button>
        </section>

        <section id="output-section" style="display: none;">
            <h2>Resultados da Simulação</h2>
            <div class="chart-container">
                <canvas id="rentabilidadeChart"></canvas>
            </div>
            <div class="chart-options">
                 <label><input type="checkbox" id="toggle-real-return"> Exibir Retorno Real (descontado IPCA)</label>
                 <label><input type="checkbox" id="toggle-historical-data"> Sobrepor Dados Históricos (IPCA/CDI)</label>
            </div>
            <div class="summary-container">
                <div class="summary-card">
                    <h4>Retorno Anualizado (Curto + CDI)</h4>
                    <p id="short-annualized-return">--%</p>
                </div>
                <div class="summary-card">
                    <h4>Retorno Anualizado (Longo)</h4>
                    <p id="long-annualized-return">--%</p>
                </div>
                <div class="summary-card">
                    <h4>CDI Break-even</h4>
                    <p id="break-even-cdi">--%</p>
                </div>
            </div>
            <div class="narrative-container">
                <h3>Interpretação dos Resultados</h3>
                <textarea id="narrativeOutput" rows="10" readonly>Aguardando cálculo...</textarea>
                <button id="copy-report-btn">Copiar Relatório</button>
                <button id="export-csv-btn">Exportar Dados (CSV)</button>
            </div>
        </section>

        <section id="advanced-analysis-section" style="display: none;">
            <h2>Análises Adicionais</h2>

            <div class="analysis-block">
                <h3><button class="analysis-toggle" data-target="duration-content">Duração &#9662;</button></h3>
                <div id="duration-content" class="analysis-content" style="display:none;">
                    <p><strong>Conceito:</strong> Duração (Macaulay Duration) mede a sensibilidade do preço do título a mudanças na taxa de juros (quanto maior, mais sensível).</p>
                    <div class="metrics-container">
                        <div class="metric-card">
                            <h4>Duração (Opção Curta)</h4>
                            <p id="short-duration">-- anos</p>
                        </div>
                        <div class="metric-card">
                            <h4>Duração (Opção Longa)</h4>
                            <p id="long-duration">-- anos</p>
                        </div>
                    </div>
                    <p id="duration-narrative">Aguardando cálculo...</p> <!-- ID updated -->
                </div>
            </div>

            <!-- Break-even IPCA section removed -->

            <div class="analysis-block">
                <h3><button class="analysis-toggle" data-target="stress-test-content">Teste de Estresse &#9662;</button></h3>
                <div id="stress-test-content" class="analysis-content" style="display:none;">
                    <p><strong>Conceito:</strong> Simula o impacto de cenários adversos (ou favoráveis) específicos nas premissas de IPCA e CDI sobre o resultado final.</p>
                    <div class="stress-input-container">
                         <label for="stress-ipca-change">Choque no IPCA (% a.a.):</label>
                         <input type="number" id="stress-ipca-change" step="0.1" placeholder="Ex: +2.0 ou -1.0">
                         <label for="stress-cdi-change">Choque no CDI (% a.a.):</label>
                         <input type="number" id="stress-cdi-change" step="0.1" placeholder="Ex: +3.0 ou -2.0">
                         <button id="run-stress-test-btn">Rodar Teste</button>
                    </div>
                    <div id="stress-test-results" style="margin-top: 1rem;">
                        <canvas id="stressTestChart" height="200"></canvas> <!-- Added canvas for chart -->
                        <p>Aguardando teste...</p>
                    </div>
                </div>
            </div>

        </section>

    </main>

    <footer>
        <p>Ferramenta de simulação Trade IPCA+ | Desenvolvido por Thomaz Fonseca</p>
    </footer>

    <script src="script.js"></script>
</body>
</html>
